# Reread the configuration file
bind l source-file ~/.tmux.conf

# Key bindings for the copy mode
set-window-option -g mode-keys vi
set-option -g default-terminal "screen-256color"

set-option -g mouse on
bind-key -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind-key -n WheelDownPane select-pane -t= \; send-keys -M
# Double LMB Select & Copy (Word)
bind-key -T copy-mode-vi DoubleClick1Pane \
    select-pane \; \
    send-keys -X select-word \; \
    send-keys -X copy-pipe "xclip -in -sel primary"
bind-key -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word \; \
    send-keys -X copy-pipe "xclip -in -sel primary"

# Triple LMB Select & Copy (Line)
bind-key -T copy-mode-vi TripleClick1Pane \
    select-pane \; \
    send-keys -X select-line \; \
    send-keys -X copy-pipe "xclip -in -sel primary"
bind-key -n TripleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-line \; \
    send-keys -X copy-pipe "xclip -in -sel primary"


# split window
bind-key v split-window -h
bind-key w split-window -v

# Open path/line candidates in the left nvim (via open_in_nvim_left)
# Usage: prefix + o -> pick path/path:line/path:line:col from pane output -> jump in left nvim
bind-key o display-popup -E "/Users/yasushi.kobayashi/.local/bin/tmux_pick_path"
# Usage: copy-mode -> select text -> Enter -> jump in left nvim
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "env TMUX_PANE_PATH='#{pane_current_path}' open_in_nvim_left"

# move between the panes in the key bindings for vim
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

bind-key m command-prompt -p "Session name >" "run-shell 'cd #{pane_current_path} \; tmux-rename-session %%'"

set -g window-status-format '#I:#(pwd="#{pane_current_path}"; echo ${pwd####*/})#F'
set -g window-status-current-format '#I:#(pwd="#{pane_current_path}"; echo ${pwd####*/})#F'
set-option -g status-interval 1

set -s escape-time 0
set -g assume-paste-time 0

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'fcsonline/tmux-thumbs'

# tmux-thumbs: open selection in left nvim
# Usage: prefix + Space -> hint -> jump in left nvim
set -g @thumbs-command 'TMUX_PANE_PATH="$(tmux display-message -p "#{pane_current_path}")" open_in_nvim_left "{}"'
set -g @thumbs-regexp-1 '([./~][^[:space:]:]+(:[0-9]+(:[0-9]+)?)?)'
set -g @thumbs-regexp-2 '([A-Za-z0-9_./~+-]+/[A-Za-z0-9_./~+.-]+(:[0-9]+(:[0-9]+)?)?)'
run-shell '~/.tmux/plugins/tpm/tpm'
bind v split-window -h \; select-layout even-horizontal
